<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Asset Allocator</title>

    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <!-- <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
    <link type="text/css" href="css/bootstrap.min.css" rel="stylesheet" />	
    <link type="text/css" href="css/jquery-ui-1.9.1.custom.min.css" rel="stylesheet" />	
    
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.9.1.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="js/jquery.tagcloud.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/jquery.flot.js"></script>
    <script type="text/javascript" src="js/jquery.flot.pie.js"></script>
    <script type="text/javascript" src="js/underscore.js"></script>
    <script type="text/javascript" src="js/backbone.js"></script>
    <script type="text/javascript" src="js/backbone.localStorage.js"></script>
    <script type="text/javascript" src="js/models.js"></script>

    <script type="text/template" id="portfolio-template">
        <div class="well span8">
            <table class="table table-striped table-bordered table-hover">
                <caption><%=name%></caption>
                <thead>
                    <tr><th>Name</th>
                        <th>Asset class</th>
                        <th>Amount</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="portfolio-assets">
                    <% _.each(assets,function(asset){ %>
                        <tr>
                            <td><%=asset.name%></td>
                            <td><%=asset.assetClass%></td>
                            <td><input type="text" class="currentValue input-small" style="margin:0" value="<%=asset.currentValue%>"/></td>
                            <td></td>
                        </tr>
                    <% });%>
                <tr><form class="form-inline">
                        <td><input type="text" class="add-asset-name input-small" placeholder="Asset name"></td>
                        <td><input type="text" class="add-asset-class input-small" placeholder="Asset class"></td>
                        <td><input type="number" class="add-asset-value input-small" placeholder="Amount"></td>
                        <td><button class="add-asset-btn btn">Add asset</button></td>
                </form></tr>
                </tbody>
            </table>
        </div>
      <div class="span4">
            <div class="portfolio-allocation-pie graph">
            </div>
      </div>
    </script>    

    <script type="text/template" id="asset-allocation-profile-template">
        <div class="well span8">
            <table class="table table-striped table-bordered table-hover">
                <caption>Asset Allocation Profile</caption>
                <thead>
                    <tr>
                        <th>Asset class</th>
                        <th>Target %</th>
                        <th>Value</th>
                        <th>%</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="asset-allocation-profile-assets">
                    <% _.each(assetClasses,function(assetClass){
                        console.log('render profile template loop');
                        var assetValue=window.portfolios.getAssetClassValue(assetClass.assetClass);
                        %>
                        <tr>
                            <td><%=assetClass.assetClass%></td>
                            <td><%=assetClass.target%></td>
                            <td><%=assetValue.currentValue%></td>
                            <td><%=Math.floor(assetValue.percentage*100.0)%></td>
                            <td></td>
                        </tr>
                    <% });%>
                <tr><form class="form-inline">
                        <td><input type="text" id="profile-add-asset-class" class="input-small" placeholder="Asset class"></td>
                        <td><input type="number" id="profile-add-asset-target" class="input-small" placeholder="Target %"></td>
                        <td><button id="add-asset-class-btn" class="btn">Add asset class</button></td>
                </form></tr>
                </tbody>
            </table>
        </div>
      <div class="span4">
            <div id="allocation_pie" class="graph">
            </div>
      </div>
    </script>

    <script>

    function plotAllocation(portfolios)
    {
        $.plot($("#allocation_pie"),portfolios.sumAssetClasses(),
        {
            series:{
                pie:{
                    show:true
                }
            }
        });
    }

    $(document).ready(function() {

        $("#add-asset-class-btn").click(function(){
            if(!window.profile) return;
            var assetClass=$("#profile-add-asset-class").val();
            var assetTarget=Number($("#profile-add-asset-target").val());

            if(!assetClass || !assetTarget)
            {
                alert("Please fill in all form fields.");
                return;
            }
            window.profile.addAssetClass({'assetClass':assetClass,'target':assetTarget});
            $("#profile-add-asset-class").val('');
            $("#profile-add-asset-target").val('');
            return false;
        });

        $("#portfolio-form").dialog({
            autoOpen:false,
            height:250,
            width:250,
            modal:true,
            buttons:{
                "Create a portfolio":function(){
                    var portfolio=portfolios.create({'name':$('#portfolio-name').val()});
                    portfolio.on('changeassets',function(event){
                        window.portfolioAssetView.render();
                        plotAllocation(window.portfolios);
                    });
                    portfolio.save();
                    $('#portfolio-name').val('');
                    $(this).dialog("close");
                }
                ,
                Cancel:function(){
                    $(this).dialog("close");
                }
            },
            close:function()
            {
            }
        });

            $('#add-portfolio').click(function(){
                $("#portfolio-form").dialog("open"); 
            });

            
            plotAllocation(portfolios);

      });
    </script>
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
    }

    td{padding: 0;}

      .sidebar-nav {
        padding: 9px 0;
      }

      .hero-unit {
        padding: 20px;
        margin-bottom: 20px;
        background-color: #f5f5f5;
        -webkit-border-radius: 6px;
        -moz-border-radius: 6px;
        border-radius: 6px;
      }
      .hero-unit h2 {
        margin-bottom: 0;
        font-size: 20px;
        line-height: 1;
        letter-spacing: -1px;
      }
      .hero-unit p {
        font-size: 14px;

        font-weight: 200;
        line-height: 22px;
      }

      .mlt a
      {
        color:#00FF00;
        text-decoration: none
      }
      .title
      {
        color:black;
        font-weight:bold;
    }
    div.graph
    {
        width:300px;
        height:200px;
        float:left;
        border:1px dashed gainsboro;
    }
    </style>	
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Asset Allocator</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="/">Home</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
            <div class="row-fluid" id="asset-allocation-profile">
            </div>
            <div class="row-fluid" id="portfolios">
                <!--<div class="well span8" id="portfolios">
                </div>-->

            <a class="btn" id="add-portfolio">Add Portfolio</a>
          </div>
      </div>
        </div>
      </div>
    </div>
</body>
<div id="portfolio-form" title="Create new portfolio">
    <form>  
        <fieldset>
            <label for="portfolio-name">Name</label>
            <input type="text" name="portfolio-name" id="portfolio-name" class="text ui-widget-content ui-corner-all"/>
        </fieldset>
    </form>
</div>
</html>


